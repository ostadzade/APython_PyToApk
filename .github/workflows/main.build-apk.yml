name: Build APK

on:
  push:
    branches:
      - main  # Ù‡Ø± Ø¨Ø§Ø± Ú©Ù‡ Ø¨Ù‡ Ø´Ø§Ø®Ù‡ main ØªØºÛŒÛŒØ±Ø§ØªÛŒ push Ø´ÙˆØ¯ØŒ Ø§ÛŒÙ† workflow Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

jobs:
  build:
    runs-on: ubuntu-latest  # Ø§Ø¬Ø±Ø§ÛŒ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø±ÙˆÛŒ ÛŒÚ© Ù…Ø§Ø´ÛŒÙ† Ù…Ø¬Ø§Ø²ÛŒ Ubuntu

    steps:
      # Ù…Ø±Ø­Ù„Ù‡ Û±: Ú†Ú©â€ŒØ§ÙˆØª Ú©Ø¯Ù‡Ø§ÛŒ Ù…Ø®Ø²Ù†
      - name: Checkout repository
        uses: actions/checkout@v3

      # Ù…Ø±Ø­Ù„Ù‡ Û²: ØªÙ†Ø¸ÛŒÙ… Ù…Ø­ÛŒØ· Ù¾Ø§ÛŒØªÙˆÙ†
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'  # Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØªÙˆÙ† Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²

      # Ù…Ø±Ø­Ù„Ù‡ Û³: Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ù†ØµØ¨ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ†
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f "requirements.txt" ]; then pip install -r requirements.txt; else echo "âš  requirements.txt not found!"; fi

      # Ù…Ø±Ø­Ù„Ù‡ Û´: Ø¯ÛŒØ¨Ø§Ú¯ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ
      - name: Debug Directories
        run: |
          echo "ğŸ“‚ Ù„ÛŒØ³Øª Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ:"
          pwd
          ls -lah

      # Ù…Ø±Ø­Ù„Ù‡ Ûµ: Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø¨Ø²Ø§Ø± PyToApk Ùˆ Ø¨Ø±Ø±Ø³ÛŒ ØµØ­Øª Ú©Ù„ÙˆÙ† Ø´Ø¯Ù†
      - name: Clone PyToApk
        run: |
          git clone https://github.com/APython-project/PyToApk.git
          if [ -d "PyToApk" ]; then echo "âœ… PyToApk cloned successfully"; else echo "âŒ Failed to clone PyToApk"; exit 1; fi

      # Ù…Ø±Ø­Ù„Ù‡ Û¶: Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ `build.py` Ø¯Ø± Ù…Ø®Ø²Ù† PyToApk
      - name: Check for build.py
        run: |
          ls -lah PyToApk
          if [ -f "PyToApk/build.py" ]; then echo "âœ… build.py found"; else echo "âŒ build.py not found!"; exit 1; fi

      # Ù…Ø±Ø­Ù„Ù‡ Û·: Ø³Ø§Ø®Øª APK Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ
      - name: Build APK
        run: |
          cd PyToApk
          python build.py apk --sourceDir ../ --buildDebug || { echo "âŒ Build failed!"; exit 1; }

      # Ù…Ø±Ø­Ù„Ù‡ Û¸: Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯Ù† Ø³Ø§Ø®Øª `output.apk`
      - name: Check APK Output
        run: |
          if [ -f "PyToApk/output.apk" ]; then echo "âœ… APK build successful"; else echo "âŒ APK not found!"; exit 1; fi

      # Ù…Ø±Ø­Ù„Ù‡ Û¹: Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ APK Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ø®Ø±ÙˆØ¬ÛŒ
      - name: Upload APK as artifact
        uses: actions/upload-artifact@v3
        with:
          name: app-debug.apk
          path: PyToApk/output.apk  # Ù…Ø³ÛŒØ± Ø®Ø±ÙˆØ¬ÛŒ APK Ø³Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡
